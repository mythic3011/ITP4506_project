<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Order Records | Legend Motor Company</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="../../../resources/image/icon-removebg.png" rel="icon" type="image/x-icon" />
    <link rel="stylesheet" href="../../../resources/css/main.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../../../resources/js/Sales/CustomerDashboard.js"></script>
    <script src="../../../resources/js/Sales/CustomerNavigation.js"></script>
    <script src="../../../resources/js/Sales/Wishlist.js"></script>
    <script src="../../../resources/js/Sales/Checkout.js"></script>
    <script src="../../../resources/js/script.js"></script>
</head>

<body class="bg-gray-50 font-sans">
    <header class="navbar bg-white shadow-md sticky top-0 z-10">
    </header>
    <main class="flex flex-col flex-grow p-6 overflow-y-auto">
        <div class="flex flex-col flex-grow p-6 overflow-y-auto">
            <main class="">
                <div class="flex justify-between items-center mb-4">
                    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white">Order Records</h1>
                    <div class="flex items-center">
                        <label for="sort-select" class="mr-2 text-sm text-gray-700 dark:text-gray-300">Sort by:</label>
                        <select id="sort-select"
                            class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md py-2 px-4 focus:outline-none focus:ring focus:ring-blue-500">
                            <option value="">Select...</option>
                            <option value="orderId">Order ID</option>
                            <option value="status">Status</option>
                            <option value="">Expected Delivery Date</option>
                            <option value="">Order Date</option>
                            <option value="">Total Amount</option>
                        </select>

                        <!-- Search Bar -->
                        <input type="text" id="search-bar-orders" placeholder="Search Order Records..."
                            class="border rounded px-4 py-1 ml-2" />
                        <button id='search-button'
                            class='bg-blue-500 text-white rounded px-4 py-[6px] ml-[6px]'>Search</button>
                    </div>
                </div>

                <!-- Total Orders Count -->
                <p class='mb-[16px] text-gray-[700] dark:text-gray-[300]'>Total Orders:
                    <span id='total-orders' class='font-bold'>0</span>
                </p>

                <!-- Loading Spinner -->
                <div id='loadingSpinner' class='hidden justify-center items-center my-[16px]'>
                    <div class='animate-spin rounded-full h-[40px] w-[40px] border-b-[3px] border-blue-[500]'></div>
                </div>

                <!-- Orders Table -->
                <div class='overflow-x-auto bg-white dark:bg-gray-[800] shadow-md rounded-lg'>
                    <table id='order-table' class='min-w-full divide-y divide-gray-[200] dark:divide-gray-[700]'>
                        <!-- Table Header -->
                        <thead class='bg-gray-[50] dark:bg-gray-[700]'>
                            <tr>
                                <!-- Table Columns -->
                                <!-- Each th represents a column in the table -->
                            </tr>
                        </thead>
                        <!-- Table Body -->
                        <tbody id='order-body'
                            class='bg-white dark:bg-gray-[800] divide-y divide-gray-[200] dark:divide-gray-[700]'>
                            <!-- Order rows will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </main>
            <!-- Footer -->
            <footer class='border-t border-gray-200 text-center py-16 mt-32'>
                <div class="container mx-auto px-4 py-8">
                    <div class="flex flex-wrap items-center justify-between md:flex-no-wrap">
                        <div class="flex items-center mb-6 md:mb-0">
                            <span class="text-sm text-gray-500 ">Copyright &copy; 2024 Legend Motor Company</span>
                        </div>
                        <div class="flex items-center justify-between space-x-6 md:space-x-12 ms:hidden">
                            <div class="flex items-center justify-between space-x-6">
                                <div class="flex items-center">
                                    <span
                                        class="bg-gray-200   rounded-full mx-3 h-5 w-5 opacity-20 group-hover:opacity-0"></span>
                                    <a class="text-gray-600 " href="#">About Us</a>
                                    <span
                                        class="bg-gray-200   rounded-full mx-3 h-5 w-5 opacity-20 group-hover:opacity-0"></span>
                                    <a class="text-gray-600 " href="#">Contact Us</a>
                                    <span
                                        class="bg-gray-200   rounded-full mx-3 h-5 w-5 opacity-20 group-hover:opacity-0"></span>
                                    <a class="text-gray-600 " href="#">Order Tracking</a>
                                    <span
                                        class="bg-gray-200   rounded-full mx-3 h-5 w-5 opacity-20 group-hover:opacity-0"></span>
                                    <a class="text-gray-600 " href="#">Returns</a>
                                    <span
                                        class="bg-gray-200   rounded-full mx-3 h-5 w-5 opacity-20 group-hover:opacity-0"></span>
                                    <a class="text-gray-600 " href="#">FAQ</a>
                                </div>
                                <div class="flex items-center">
                                    <a class="text-gray-600 " href="#">Terms of Service</a>
                                    <span
                                        class="bg-gray-200   rounded-full mx-3 h-5 w-5 opacity-20 group-hover:opacity-0"></span>
                                    <a class="text-gray-600 " href="#">Privacy Policy</a>
                                    <span
                                        class="bg-gray-200   rounded-full mx-3 h-5 w-5 opacity-20 group-hover:opacity-0"></span>
                                    <a class="text-gray-600 " href="#">Site Map</a>
                                    <span
                                        class="bg-gray-200   rounded-full mx-3 h-5 w-5 opacity-20 group-hover:opacity-0"></span>
                                    <a class="text-gray-600 " href="#">Contact Us</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
</body>
<script src="../../../resources/js/Sales/CustomerDashboard.js"></script>
<script src="../../../resources/js/Sales/CustomerNavigation.js"></script>
<script src="../../../resources/js/Sales/Wishlist.js"></script>
<script src="../../../resources/js/Sales/Checkout.js"></script>
<script>
    const HARDCODED_ORDERS = [
        {
            id: 1,
            orderNumber: "ORD-2024-001",
            date: "2024-01-15",
            status: "processing",
            customer: {
                id: 1,
                name: "John Doe",
                email: "john@example.com",
                phone: "+1 234-567-8900"
            },
            vehicle: {
                make: "Toyota",
                model: "Camry",
                color: "Blue",
                upgrades: [
                    { name: "Engine", price: 25999 },
                    { name: "Transmission", price: 12999 },
                    { name: "Suspension", price: 7999 },
                    { name: "Brakes", price: 4999 }
                ],
                insurancePlans: [
                    { planName: "Basic Coverage", annualPremium: 1298, coverageLimit: 88253 },
                    { planName: "Comprehensive Coverage", annualPremium: 1898, coverageLimit: 66059 }
                ],
                price: 25999
            },
            payment: {
                status: "pending",
                amount: 25999,
                method: "credit_card"
            }
        },
        {
            id: 2,
            orderNumber: "ORD-2024-002",
            date: "2024-01-16",
            status: "pending",
            customer: {
                id: 2,
                name: "Jane Smith",
                email: "jane@example.com",
                phone: "+1 234-567-8901"
            },
            vehicle: {
                make: "Honda",
                model: "Accord",
                color: "Red",
                upgrades: [
                    { name: "Engine", price: 22999 },
                    { name: "Transmission", price: 14999 },
                    { name: "Suspension", price: 6999 },
                    { name: "Brakes", price: 3999 }
                ],
                insurancePlans: [
                    { planName: "Basic Coverage", annualPremium: 1198, coverageLimit: 116163 },
                    { planName: "Comprehensive Coverage", annualPremium: 1798, coverageLimit: 77804 }
                ],
                price: 28999
            },
            payment: {
                status: "pending",
                amount: 28999,
                method: "bank_transfer"
            }
        }
    ]
    // Retrieve user and order data from local storage
    const user = localStorage.getItem('username');
    const userInfo = JSON.parse(localStorage.getItem('orders_user'));
    const orders = HARDCODED_ORDERS; // Fallback to hardcoded orders if none in local storage

    // Function to display orders
    function displayOrders(orders) {
        const orderBody = $('#order-body');
        orderBody.empty(); // Clear existing content

        if (orders.length > 0) {
            $('#total-orders').text(orders.length);
            $('#order-table').show();

            orders.forEach(order => {
                const row = $('<tr>').addClass('hover:bg-gray-100 dark:hover:bg-gray-700');

                row.append(createCell('td', order.orderNumber, 'px-4 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white'));
                row.append(createCell('td', formatDate(order.date), 'px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 hidden sm:table-cell'));
                row.append(createCell('td', formatTime(order.date), 'px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 hidden md:table-cell'));
                row.append(createCell('td', formatDate(order.deliveryDate), 'px-4 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 hidden lg:table-cell'));
                row.append(createCell('td', `$${order.payment.amount.toLocaleString()}`, 'px-4 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white font-medium'));

                const statusCell = $('<td>').addClass('px-4 py-4 whitespace-nowrap');
                const statusSpan = $('<span>').addClass(`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(order.status)}`).text(order.status);
                statusCell.append(statusSpan);
                row.append(statusCell);

                // Create View Link Cell
                const viewLinkCell = $('<td>').addClass('px-4 py-4 whitespace-nowrap text-sm font-medium');
                const viewLink = $('<a>')
                    .attr('href', `OrderDetails.html?id=${order.id}`)
                    .addClass('text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300')
                    .text('View');
                viewLinkCell.append(viewLink);
                row.append(viewLinkCell);

                orderBody.append(row);
            });
        } else {
            $('#order-table').hide();
            $('#total-orders').text('0');
            displayError('No orders found');
        }
    }

    // Function to create a table cell
    function createCell(tag, textContent, className) {
        return $(`<${tag}>`).addClass(className).text(textContent);
    }

    // Function to format date
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString(); // Format date as per locale
    }

    // Function to format time
    function formatTime(dateString) {
        const time = new Date(dateString);
        return time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); // Format time as HH:MM
    }

    // Function to get status class for styling
    function getStatusClass(status) {
        switch (status.toLowerCase()) {
            case 'processing':
                return 'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100';
            case 'pending':
                return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100';
            case 'shipped':
                return 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100';
            case 'cancelled':
                return 'bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100';
            default:
                return 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100';
        }
    }

    // Initialize display of orders
    $(document).ready(() => {
        displayOrders(orders);
    });
</script>