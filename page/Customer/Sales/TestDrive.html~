<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Drive | Legend Motor Company</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <meta content="Test Drive" name="description">
    <meta content="test drive, legend motor company" name="keywords">
    <meta content="noindex, nofollow" name="robots">
    <link href="../../../resources/image/icon_dark.png" rel="icon" type="image/x-icon"/>
    <script type="module" src="../../../resources/js/TestDrive.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="../../../resources/css/main.css">
    <script src="../../../resources/js/Sales/CustomerDashboard.js"></script>
    <script src="../../../resources/js/Sales/CustomerNavigation.js"></script>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/hero.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/vehicles.css">
    <link rel="stylesheet" href="css/offers.css">
    <link rel="stylesheet" href="css/contact.css">
    <link rel="stylesheet" href="css/footer.css">
    <script>
    </script>
</head>
<body>
<header class="navbar bg-white shadow-md sticky top-0 z-10">
    <div class="container mx-auto flex justify-between items-center p-4 bg-white">
        <!-- Logo -->
        <a href="#" class="flex items-center">
            <img src="../../../resources/image/icon-removebg.png" alt="Legend Motor Limited" class="h-12 w-12">
            <span class="ml-3 text-xl font-bold">LMC</span>
        </a>

        <!-- Search Bar -->
        <div class="relative flex-grow mx-4">
            <label for="search-bar-vehicles" class="absolute left-2 top-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
            </label>
            <input type="text" id="search-bar-vehicles" placeholder="Search Vehicles..."
                   class="border rounded px-10 py-1 w-full focus:outline-none focus:ring focus:ring-primary-light"/>
        </div>

        <!-- Navigation Links -->
        <nav id="nav_link" class="md:flex space-x-4 gap-1">
            <a class="navbar_a text-gray-700 hover:text-blue-500" href="../index.html">Home</a>

            <!-- Vehicles Dropdown -->
            <div class="relative group">
                <button class="navbar_a text-gray-700 hover:text-blue-500 transition duration-200 cursor-pointer"
                        id="Vehicles-dropdown-toggle">
                    Vehicles
                </button>
                <div class="dropdown hidden absolute bg-white shadow-lg rounded-md mt-1 z-[100]"
                     id="Vehicles-dropdown">
                    <nav class="nav-links flex flex-col space-y-2 p-2 gap-5">
                        <a class="hover:bg-gray-100 px-[10px] py-[8px]" href="./ViewVehicles.html">Vehicles</a>
                        <a class="hover:bg-gray-100 px-[10px] py-[8px]" href="./Wishlist.html">Wishlist</a>
                        <a class="hover:bg-gray-100 px-[10px] py-[8px]" href="./viewOrderRecord.html">Orders</a>
                    </nav>
                </div>
            </div>

            <!-- Insurance Dropdown -->
            <div class="relative group">
                <button class="navbar_a text-gray-700 hover:text-blue-500 transition duration-200 cursor-pointer"
                        id="Insurance-dropdown-toggle">
                    Insurance
                </button>
                <div class='dropdown hidden absolute bg-white shadow-lg rounded-md mt-1 z-[100]'
                     id="Insurance-dropdown">
                    <nav class="nav-links flex flex-col space-y-2 p-2 gap-[5px]">
                        <a href="../Insurance/index.html">Insurance</a>
                        <a href="../Insurance/progress.html">Apply</a>
                        <a href="../Insurance/ordersIndex.html">Application</a>
                    </nav>
                </div>
            </div>
        </nav>

        <!-- Notification Button -->
        <div id="notificationsBtn" class="relative mx-[10px]">
            <button aria-label="Notifications" aria-haspopup="true" aria-expanded="false" id="notificationToggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2">
                    <path d='M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9'></path>
                    <path d='M13.73 21a2 2 0 0 1-3.46'></path>
                </svg>
                <span
                        class='notification-badge absolute top-[5px] right-[5px] bg-red text-white rounded-full px-[5px] text-xs'>3</span>
            </button>
        </div>
        <!-- User Menu -->
        <div class="relative group">
            <div class="relative flex items-center gap-2 p-2 bg-gray-100 rounded-md shadow-sm border "
                 id="user-menu">
                <!-- User Avatar -->
                <span
                        class="user-avatar bg-blue-500 rounded-full h-[40px] w-[40px] flex items-center justify-center text-white font-bold"
                        id="username-avatar">
                        C
                    </span>
                <!-- Username -->
                <span class="user-name text-gray-800 font-medium" id="username-name">customer</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600 user-menu-Dropdown-Arrow-svg"
                     fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
            </div>
            <div id="user-Submenu"
                 class="dropdown hidden absolute right-0 bg-white shadow-lg rounded-md mt-2 z-[100] w-[150px]">
                <nav class="nav-links flex flex-col space-y-2 p-2">
                    <a href="../profile.html"
                       class="dropdown-item block px-4 py-2 text-gray-700 hover:bg-blue-100 rounded-md transition duration-150">
                        Profile
                    </a>
                    <a href="../logout.html"
                       class="dropdown-item block px-4 py-2 text-gray-700 hover:bg-blue-100 rounded-md transition duration-150">
                        Logout
                    </a>
                </nav>
            </div>
        </div>
    </div>
</header>
<main>
    <!-- Hero Section -->
    <section class="h-screen bg-cover bg-center text-white relative hero"
             style="background-image: url('./img/car_interior.jpg');">
        <div class="absolute top-0 left-0 w-full h-full bg-black bg-opacity-50"></div>
        <div class="relative z-10 h-full flex flex-col justify-center items-center text-center">
            <h1 class="text-5xl md:text-6xl font-bold mb-4">Book Your Test Drive</h1>
            <p class="text-xl md:text-2xl mb-8">Experience the thrill of driving your dream car today.</p>
        </div>
    </section>
    <!-- Vehicle Selection -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Choose Your Vehicle</h2>
            <div id="vehicle-selection" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </div>
    </section>

    <!-- Vehicle Details -->
    <section id="vehicle-details" class="py-16 bg-gray-200">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Vehicle Details</h2>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-2xl font-bold mb-4" id="VehicleName"></h3>
                        <p class="text-gray-700 mb-4" id="VehicleDescription"></p>
                        <ul class="list-disc ml-6 text-gray-700 mb-4">
                            <li>Advanced Safety Features</li>
                            <li>Easy-to-Use Technology</li>
                            <li>Superior Fuel Efficiency</li>
                        </ul>
                    </div>
                    <div class="hidden md:block">
                        <img id="VehicleImage" src="" alt="Vehicle Image" class="w-full h-auto object-cover rounded-lg">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Booking Form -->
    <section id="booking-form" class="py-16 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Book Your Test Drive</h2>
            <form id="testDriveForm" class="bg-white p-6 shadow-md rounded-lg">
                <div class="mb-4">
                    <label for="name" class="block mb-2 text-sm font-medium text-gray-900">Name</label>
                    <input type="text" id="name" name="name"
                           class="border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                           required>
                </div>
                <div class="mb-4">
                    <label for="email" class="block mb-2 text-sm font-medium text-gray-900">Email</label>
                    <input type="email" id="email" name="email"
                           class="border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                           required>
                </div>
                <div class="mb-4">
                    <label for="phone" class="block mb-2 text-sm font-medium text-gray-900">Phone</label>
                    <input type="tel" id="phone" name="phone"
                           class="border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                </div>
                <div class="mb-4">
                    <label for="vehicle-test-option" class="block mb-2 text-sm font-medium text-gray-900">Select
                        Vehicle</label>
                    <select id="vehicle-test-option" name="vehicle"
                            class="border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        <option value="" disabled selected>Choose a model</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="date" class="block mb-2 text-sm font-medium text-gray-900">Preferred Date</label>
                    <input type="date" id="date" name="date"
                           class="border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                           required>
                </div>
                <div class="mb-4">
                    <label for="time" class="block mb-2 text-sm font-medium text-gray-900">Preferred Time</label>
                    <input type="time" id="time" name="time"
                           class="border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                           required>
                </div>
                <div class="flex justify-center">
                    <button type="submit"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded focus:outline-none focus:ring-4 focus:ring-blue-300">
                        Book Now
                    </button>
                </div>
            </form>
        </div>
    </section>

    <!-- Testimonials -->
    <section id="testimonials" class="py-16 bg-gray-100">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">What Our Customers Say</h2>
            <div id="testimonial-carousel" class="carousel relative">
                <div class="carousel-inner relative overflow-hidden"></div>
                <button class="carousel-control-prev absolute top-0 bottom-0 left-0 flex items-center justify-center p-10 text-4xl font-semibold text-white hover:text-blue-600"
                        data-slide="prev">‹
                </button>
                <button class="carousel-control-next absolute top-0 bottom-0 right-0 flex items-center justify-center p-10 text-4xl font-semibold text-white hover:text-blue-600"
                        data-slide="next">›
                </button>
            </div>
        </div>
    </section>
</main>
<footer class="bg-gray-900 text-white py-6">
    <div class="container mx-auto px-6 text-center">
        <p>&copy; 2023 Legend Motor Company. All rights reserved.</p>
    </div>
</footer>
<script>
    $(document).ready(function () {
        let vehicles = JSON.parse(localStorage.getItem('vehicles')) || fetchVehicles();

        // ?id=vehicleid
        const vehicleid = window.location.search.split('=')[1];
        console.log(vehicleid);
        if (vehicleid) {
            // set vehicle name and description
            $('#VehicleName').text(vehicles.find(v => v.id === parseInt(vehicleid)).make + ' ' + vehicles.find(v => v.id === parseInt(vehicleid)).model);
            $('#VehicleDescription').text(getVehicleDescription(vehicles.find(v => v.id === parseInt(vehicleid)).id));
            $('#testDriveForm #vehicle-test-option').val(vehicles.find(v => v.id === parseInt(vehicleid)).model.toLowerCase().replace(/\s+/g, '')); // Set default selection
        } else {
            // redirect to 404 page
            window.location.href = '404.html';
        }

        async function fetchVehicles() {
            try {
                const data = await $.getJSON("../../../resources/json/vehicles.json");
                const vehicles = data.map(vehicle => ({
                    id: vehicle.id,
                    make: vehicle.make || 'Unknown',
                    model: vehicle.model || 'Unknown',
                    modelCode: vehicle.modelCode || 'N/A',
                    manufacturingYear: vehicle.manufacturingYear || 'N/A',
                    carType: vehicle.carType || 'N/A',
                    fuelType: vehicle.fuelType || 'N/A',
                    year: vehicle.year || 'N/A',
                    price: vehicle.price || 0,
                    images: vehicle.images || [],
                    availableColors: Array.isArray(vehicle.availableColors) ? vehicle.availableColors.map(color => ({
                        name: color.name, hexCode: color.hexCode
                    })) : [],
                    upgradeOptions: {
                        interiorUpgrades: Array.isArray(vehicle.upgradeOptions?.interiorUpgrades) ? vehicle.upgradeOptions.interiorUpgrades : [],
                        performanceUpgrades: Array.isArray(vehicle.upgradeOptions?.performanceUpgrades) ? vehicle.upgradeOptions.performanceUpgrades : [],
                        technologyUpgrades: Array.isArray(vehicle.upgradeOptions?.technologyUpgrades) ? vehicle.upgradeOptions.technologyUpgrades : []
                    },
                    insurancePlans: Array.isArray(vehicle.insurancePlans) ? vehicle.insurancePlans.map(option => ({
                        planName: option.planName,
                        annualPremium: option.annualPremium,
                        coverageLimit: option.coverageLimit || null,
                        deductible: option.deductible || null
                    })) : [],
                    specifications: {
                        engine: vehicle.specifications.engine,
                        transmission: vehicle.specifications.transmission,
                        mileage: vehicle.specifications.mileage,
                        safetyRating: vehicle.specifications.safetyRating || null,
                        warrantyYears: vehicle.specifications.warrantyYears || null
                    }
                }));
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                populateVehicleSelection(vehicles);
                populateVehicleOptions(vehicles);
                return vehicles;
            } catch (error) {
                console.error("Error fetching vehicles:", error);
                return []; // Return an empty array on error to prevent further issues
            }
        }

        function populateVehicleSelection(vehicles) {
            const vehicleSelection = $('#vehicle-selection');
            vehicleSelection.empty();
                const sellingPoints = [
        'Experience luxury and performance',
        'Stand out with style and strength',
        'Feel the rush of high-speed innovation',
        'Embrace cutting-edge technology',
        'Unlock unmatched versatility on any terrain',
        'Discover the harmony of power and efficiency',
        'Elevate your driving experience',
        'Command attention around every curve',
        'Enjoy supreme comfort and sophistication',
        'Push the boundaries of adventure',
        'Navigate with precision and confidence',
        'Set new standards for performance',
        'Drive your ambition to new heights',
        'Indulge in bespoke luxury',
        'Experience the thrill of the open road',
        'Unleash your inner thrill-seeker',
        'Awaken your senses with dynamic design',
        'Conquer the streets with unrivaled agility',
        'Transform every journey into a masterpiece',
        'Capture the spirit of freedom',
        'Ignite your passion for driving',
        'Achieve extraordinary performance',
        'Lead the evolution of automotive excellence',
        'Seek perfection in every detail',
        'Revitalize your drive',
        'Become one with the road',
        'Delight in sophisticated engineering',
        'Master every road with grace',
        'Reimagine your connection to the road',
        'Explore the future of mobility'
    ];

            vehicles.forEach(vehicle => {
                const vehicleCard = `
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                        <img src="${vehicle.images[0]?.url || 'default-image.jpg'}" alt="${vehicle.make} ${vehicle.model}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h3 class="text-xl font-bold">${vehicle.make} ${vehicle.model}</h3>
                            <p class="text-gray-700">${vehicle.specifications.engine}</p>
                            <p class="text-gray-700">${vehicle.price} USD</p>
                            <a href="#vehicle-details" class="text-blue-500 hover:underline">View Details</a>
                        </div>
                    </div>
                `;
                vehicleSelection.append(vehicleCard);
            });
        }

        function populateVehicleOptions(vehicles) {
            const vehicleTestOption = $('#vehicle-test-option');
            vehicleTestOption.empty();
            vehicles.forEach(vehicle => {
                const option = `<option value="${vehicle.model.toLowerCase().replace(/\s+/g, '')}">${vehicle.make} ${vehicle.model}</option>`;
                vehicleTestOption.append(option);
            });
        }

        // Function to show selected vehicle details
        $(document).on('click', 'a[href="#vehicle-details"]', function (e) {
            e.preventDefault();
            const vehicleName = $(this).text().split(' ')[1];
            $('#vehicle-details h3').text(vehicleName);
            $('#vehicle-details p:first').text(getVehicleDescription(vehicleName));
            $('#testDriveForm #vehicle').val(vehicleName.toLowerCase().replace(/\s+/g, '')); // Set default selection
        });

        function getVehicleDescription(id) {
            const descriptions = [
                "Experience luxury and performance with the new {modelName}. It comes equipped with advanced safety features, easy-to-use technology, and superior fuel efficiency.",
                "Stand out with the style and strength of the new {modelName}. It features sleek design, powerful performance, and innovative safety technologies.",
                "Experience the thrill of the open road with the new {modelName}. Known for its affordability, versatility, and durable build."
            ];
            return descriptions[Math.floor(Math.random() * descriptions.length)].replace('{modelName}', id);
        }

        // Form Validation and Submission
        $('#testDriveForm').on('submit', function (e) {
            e.preventDefault(); // Prevent default form submission

            // Validate input fields
            const name = $('#name').val().trim();
            const email = $('#email').val().trim();
            const phone = $('#phone').val().trim();
            const vehicle = $('#vehicle').val();
            const date = $('#date').val();
            const time = $('#time').val();

            // Reset border color
            $('#name, #email, #phone, #vehicle, #date, #time').removeClass('border-red-500');

            if (!name) {
                $('#name').addClass('border-red-500').focus();
                return alert('Please enter your name.');
            }
            if (!email) {
                $('#email').addClass('border-red-500').focus();
                return alert('Please enter your email.');
            }
            if (!validateEmail(email)) {
                $('#email').addClass('border-red-500').focus();
                return alert('Please enter a valid email address.');
            }
            if (!vehicle) {
                $('#vehicle').addClass('border-red-500').focus();
                return alert('Please select a vehicle.');
            }
            if (!date) {
                $('#date').addClass('border-red-500').focus();
                return alert('Please select a preferred date.');
            }
            if (!time) {
                $('#time').addClass('border-red-500').focus();
                return alert('Please select a preferred time.');
            }

            // Proceed with booking logic (e.g., AJAX call)
            alert('Test drive booked successfully!');
            // Optionally redirect to confirmation page
            window.location.href = 'confirmation.html';
        });

        // Email validation function
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Testimonial Carousel
        let currentIndex = 0;
        const items = $('.carousel-item');
        const numItems = items.length;

        function showItem(index) {
            items.removeClass('active').eq(index).addClass('active');
        }

        function nextItem() {
            currentIndex = (currentIndex + 1) % numItems;
            showItem(currentIndex);
        }

        function prevItem() {
            currentIndex = (currentIndex - 1 + numItems) % numItems;
            showItem(currentIndex);
        }

        $('.carousel-control-next').click(nextItem);
        $('.carousel-control-prev').click(prevItem);

        // Auto-slide the carousel every 5 seconds
        setInterval(nextItem, 5000);
    });
</script>