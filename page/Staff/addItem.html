<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Add Item | Legend Motor Limited</title>
    <meta name="Keywords" content="Add Item page, Legend Motor Limited" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="generator" content="Legend Motor Limited" />
    <meta
      name="copyright"
      content="Copyright &copy; 2024 Legend Motor Limited"
    />
    <meta name="Author" content="mythic3011,steven" />
    <link
      rel="icon"
      href="../../resources/image/LMC_login.png"
      type="image/x-icon"
    />
    <!--    <script src="../../resources/js/SalesManager.js"></script>-->
    <script src="../../resources/js/script.js"></script>
    <script src="../../resources/js/addItem.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp,container-queries"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#eff6ff",
                100: "#dbeafe",
                200: "#bfdbfe",
                300: "#93c5fd",
                400: "#60a5fa",
                500: "#3b82f6",
                600: "#2563eb",
                700: "#1d4ed8",
                800: "#1e40af",
                900: "#1e3a8a",
                950: "#172554",
              },
            },
          },
          fontFamily: {
            body: [
              "Inter",
              "ui-sans-serif",
              "system-ui",
              "-apple-system",
              "system-ui",
              "Segoe UI",
              "Roboto",
              "Helvetica Neue",
              "Arial",
              "Noto Sans",
              "sans-serif",
              "Apple Color Emoji",
              "Segoe UI Emoji",
              "Segoe UI Symbol",
              "Noto Color Emoji",
            ],
            sans: [
              "Inter",
              "ui-sans-serif",
              "system-ui",
              "-apple-system",
              "system-ui",
              "Segoe UI",
              "Roboto",
              "Helvetica Neue",
              "Arial",
              "Noto Sans",
              "sans-serif",
              "Apple Color Emoji",
              "Segoe UI Emoji",
              "Segoe UI Symbol",
              "Noto Color Emoji",
            ],
          },
        },
      };
    </script>
  </head>
  <!--------------------Menu-------------------->
  <body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white">
    <nav class="bg-white border-gray-200 dark:bg-gray-900">
      <div
        class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"
      >
        <a href="#" class="flex items-center space-x-3 rtl:space-x-reverse">
          <div class="h-8 w-8 relative">
            <img
              alt="SLMC Logo"
              class="absolute inset-0 object-contain dark:hidden pt-2 dark:pt-1"
              src="../../resources/image/SLMC_LOGO.png"
            />
            <img
              alt="SLMC Logo"
              class="absolute inset-0 object-contain hidden dark:block"
              src="../../resources/image/SLMC_LOGO_DM.png"
            />
          </div>
          <span
            class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white"
            >SLMC</span
          >
        </a>

        <div class="flex items-center md:order-2">
          <!-- Dark mode toggle button -->
          <button
            id="darkModeToggle"
            class="p-2 text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-700"
          >
            <svg
              class="w-5 h-5"
              fill="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
              ></path>
            </svg>
          </button>

          <!-- Mobile menu button -->
          <button
            id="mobile-menu-button"
            aria-controls="navbar-default"
            aria-expanded="false"
            class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
            type="button"
          >
            <span class="sr-only">Open main menu</span>
            <svg
              aria-hidden="true"
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 17 14"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1 1h15M1 7h15M1 13h15"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
              />
            </svg>
          </button>
        </div>

        <div
          class="hidden w-full md:flex md:w-auto md:order-1"
          id="navbar-default"
        >
          <ul
            class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700"
          >
            <li>
              <a
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent"
                href="order.html"
                >Order Record</a
              >
            </li>
            <li>
              <a
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent"
                href="Item.html"
                >Manage Spare Part</a
              >
            </li>
            <li>
              <a
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent"
                href="genreport.html"
                >Generate Report</a
              >
            </li>
            <li>
              <a
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent"
                href="../../logout.html"
                onclick="logout()"
                >Log Out</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <main>
      <section
        class="content bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen p-40 md:p-8"
        id="addItemSection"
      >
        <h1
          class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-blue-600 dark:text-blue-400 mb-8 md:mb-12"
        >
          Add new item
        </h1>
        <section class="form max-w-3xl mx-auto">
          <div
            class="bg-gray-100 dark:bg-gray-800 rounded-lg shadow-lg px-4 py-8 md:p-8"
          >
            <form id="addItemForm" class="space-y-4 md:space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <div class="space-y-2">
                  <label class="block text-sm font-medium"
                    >Spare part number</label
                  >
                  <p
                    id="NewSparePart-id"
                    class="text-lg font-semibold text-blue-600 dark:text-blue-400"
                  ></p>
                </div>
                <div class="space-y-2">
                  <label for="category" class="block text-sm font-medium"
                    >Spare part category</label
                  >
                  <select
                    name="category"
                    id="category"
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 appearance-none"
                  >
                    <option value="1">Category A</option>
                    <option value="2">Category B</option>
                    <option value="3">Category C</option>
                    <option value="4">Category D</option>
                  </select>
                </div>
                <div class="space-y-2">
                  <label for="input-part-no" class="block text-sm font-medium"
                    >Spare part name</label
                  >
                  <input
                    type="text"
                    id="input-part-no"
                    placeholder="Enter spare part name"
                    required
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
                <div class="space-y-2">
                  <label for="file" class="block text-sm font-medium"
                    >Upload spare part image</label
                  >
                  <input
                    type="file"
                    id="file"
                    name="img"
                    accept="image/*"
                    class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                  />
                </div>
                <div class="space-y-2">
                  <label for="input-weight" class="block text-sm font-medium"
                    >Weight</label
                  >
                  <input
                    type="number"
                    id="input-weight"
                    placeholder="Enter weight"
                    required
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
                <div class="space-y-2">
                  <label
                    for="input-stock-quantity"
                    class="block text-sm font-medium"
                    >Stock item quantity</label
                  >
                  <input
                    type="number"
                    id="input-stock-quantity"
                    placeholder="Enter stock item quantity"
                    required
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
                <div class="space-y-2">
                  <label for="input-price" class="block text-sm font-medium"
                    >Price</label
                  >
                  <input
                    type="number"
                    id="input-price"
                    placeholder="Enter price"
                    required
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
              </div>
              <div class="space-y-2">
                <label for="description" class="block text-sm font-medium"
                  >Spare part description</label
                >
                <textarea
                  id="description"
                  name="description"
                  rows="4"
                  placeholder="Enter spare part description"
                  class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                ></textarea>
              </div>
              <div
                class="flex flex-col md:flex-row md:justify-end space-y-4 md:space-y-0 md:space-x-4"
              >
                <button
                  type="submit"
                  class="w-full md:w-auto px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-offset-gray-800 transition-colors duration-200"
                >
                  Add
                </button>

                <button
                  type="button"
                  onclick="location.href='Item.html'"
                  class="w-full md:w-auto px-6 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 dark:focus:ring-offset-gray-800 transition-colors duration-200"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </section>
      </section>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        generateNewSparePartId();
        document
          .getElementById("addItemForm")
          .addEventListener("submit", handleSubmit);
      });

      function generateNewSparePartId() {
        fetch("../../resources/php/ManageItem.php?action=getNewSparePartId")
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              document.getElementById("NewSparePart-id").textContent =
                data.data;
            } else {
              throw new Error(
                data.message || "Failed to generate new spare part ID"
              );
            }
          })
          .catch((error) => {
            console.error("Error generating new spare part ID:", error);
            alert("Error generating new spare part ID: " + error.message);
          });
      }

      function handleSubmit(event) {
        event.preventDefault();
        addItem();
      }

      //make addItem() run one time only
      let isRunning = false;
      function addItem() {
        if (isRunning) {
          return;
        }
        isRunning = true;

        const sparePartNum = parseInt(
          document.getElementById("NewSparePart-id").textContent,
          10
        );
        if (isNaN(sparePartNum) || sparePartNum <= 0) {
          alert("Error: Invalid spare part number");
          isRunning = false;
          return;
        }

        var formData = {
          sparePartNum: sparePartNum,
          sparePartCategory: parseInt(
            document.getElementById("category").value,
            10
          ),
          sparePartName: document.getElementById("input-part-no").value,
          weight: parseFloat(document.getElementById("input-weight").value),
          stockItemQty: parseInt(
            document.getElementById("input-stock-quantity").value,
            10
          ),
          price: parseFloat(document.getElementById("input-price").value),
          sparePartDescription: document.getElementById("description").value,
        };

        const fileInput = document.getElementById("file");

        // Check if a file is selected
        if (fileInput.files.length > 0) {
          formData.image = fileInput.files[0].name;
        }

        console.log("Sending data:", formData);

        fetch("../../resources/php/ManageItem.php?action=add", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
          credentials: "include",
        })
          .then((response) => {
            console.log("Response status:", response.status);
            return response.text();
          })
          .then((text) => {
            console.log("Response text:", text);
            return JSON.parse(text);
          })
          .then((result) => {
            console.log("Parsed result:", result);
            if (result.status === "success") {
              console.log("Item added:", result);
              alert(
                "Spare part added successfully! New Spare Part Number: " +
                  result.data.sparePartNum
              );
              window.location.href = "Item.html";
            } else {
              throw new Error(result.message || "Failed to add spare part");
            }
          })
          .catch((error) => {
            console.error("Error adding spare part:", error);
            alert("Error adding spare part: " + error.message);
          })
          .finally(() => {
            isRunning = false;
          });
      }
    </script>
  </body>
</html>
