<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Add Item | Legend Motor Limited</title>
    <meta name="Keywords" content="Add Item page, Legend Motor Limited" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="generator" content="Legend Motor Limited" />
    <meta name="copyright" content="Copyright &copy; 2024 Legend Motor Limited" />
    <meta name="Author" content="mythic3011,steven" />
    <link
      rel="icon"
      href="../../../resources/image/icon_dark.png"
      type="image/x-icon"
    />
    <!--    <script src="../../resources/js/SalesManager.js"></script>-->
    <script src="../../../resources/js/script.js"></script>
    <script src="../../../resources/js/addItem.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp,container-queries"></script>
    <script src="../../../resources/js/Sales/StaffNavigation.js"></script>
  </head>
  <!--------------------Menu-------------------->
  <body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white">
      <header class="navbar bg-white shadow-md sticky top-0 z-10">
        <div class="mainContainer mx-auto flex justify-between items-center p-4">
            <!-- Logo -->
            <a href="#" class="flex items-center">
                <img src="../../../resources/image/icon-removebg.png" alt="Legend Motor Limited" class="h-12 w-12">
                <span class="ml-3 text-xl font-bold">LMC</span>
            </a>

            <!-- Search Bar -->
            <div class="relative flex-grow mx-4">
                <label for="search-bar-vehicles" class="absolute left-2 top-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </label>
                <input type="text" id="search-bar-vehicles" placeholder="Search Vehicles..."
                    class="border rounded px-10 py-1 w-full focus:outline-none focus:ring focus:ring-primary-light" />
            </div>

            <!-- Navigation Links -->
            <nav id="nav_link" class="hidden md:flex space-x-4 gap-1">
                <a class="navbar_a text-gray-700 hover:text-blue-500" href="">Home</a>

                <!-- Vehicles Dropdown -->
                <div class="relative group">
                    <button class="navbar_a text-gray-700 hover:text-blue-500 transition duration-200 cursor-pointer"
                        id="Vehicles-dropdown-toggle">
                        Vehicles
                    </button>
                    <div class="dropdown hidden absolute bg-white shadow-lg rounded-md mt-1 z-[100]"
                        id="Vehicles-dropdown">
                        <nav class="nav-links flex flex-col space-y-2 p-2 gap-5">
                            <a class="hover:bg-gray-100 px-[10px] py-[8px]" href="./Sales/ViewVehicles.html">Vehicles</a>
                            <a class="hover:bg-gray-100 px-[10px] py-[8px]" href="./Sales/Wishlist.html">Wishlist</a>
                            <a class="hover:bg-gray-100 px-[10px] py-[8px]" href="./Sales/viewOrderRecord.html">Orders</a>
                        </nav>
                    </div>
                </div>

                <!-- Insurance Dropdown -->
                <div class="relative group">
                    <button class="navbar_a text-gray-700 hover:text-blue-500 transition duration-200 cursor-pointer"
                        id="Insurance-dropdown-toggle">
                        Insurance
                    </button>
                    <div class='dropdown hidden absolute bg-white shadow-lg rounded-md mt-1 z-[100]'
                        id="Insurance-dropdown">
                        <nav class="nav-links flex flex-col space-y-2 p-2 gap-[5px]">
                            <a href="./Insurance/index.html">Insurance</a>
                            <a href="./Insurance/progress.html">Apply</a>
                            <a href="./Insurance/ordersIndex.html">Application</a>
                        </nav>
                    </div>
                </div>
            </nav>

            <!-- Notification Button -->
            <div id="notificationsBtn" class="relative mx-[10px]">
                <button aria-label="Notifications" aria-haspopup="true" aria-expanded="false" id="notificationToggle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d='M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9'></path>
                        <path d='M13.73 21a2 2 0 0 1-3.46'></path>
                    </svg>
                    <span
                        class='notification-badge absolute top-[5px] right-[5px] bg-red text-white rounded-full px-[5px] text-xs'>3</span>
                </button>
            </div>
            <!-- User Menu -->
            <div class="relative group">
                <div class="relative flex items-center gap-2 p-2 bg-gray-100 rounded-md shadow-sm border "
                    id="user-menu">
                    <!-- User Avatar -->
                    <span
                        class="user-avatar bg-blue-500 rounded-full h-[40px] w-[40px] flex items-center justify-center text-white font-bold"
                        id="username-avatar">
                        S
                    </span>
                    <!-- Username -->
                    <span class="user-name text-gray-800 font-medium" id="username-name">Staff</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600 user-menu-Dropdown-Arrow-svg"
                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
                <div id="user-Submenu"
                    class="dropdown hidden absolute right-0 bg-white shadow-lg rounded-md mt-2 z-[100] w-[150px]">
                    <nav class="nav-links flex flex-col space-y-2 p-2">
                        <a href="../../profile.html"
                            class="dropdown-item block px-4 py-2 text-gray-700 hover:bg-blue-100 rounded-md transition duration-150">
                            Profile
                        </a>
                        <a href="../../logout.html"
                            class="dropdown-item block px-4 py-2 text-gray-700 hover:bg-blue-100 rounded-md transition duration-150">
                            Logout
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <main>
      <section
        class="content bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen p-40 md:p-8"
        id="addItemSection"
      >
        <h1
          class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-blue-600 dark:text-blue-400 mb-8 md:mb-12"
        >
          Add new item
        </h1>
        <section class="form max-w-3xl mx-auto">
          <div
            class="bg-gray-100 dark:bg-gray-800 rounded-lg shadow-lg px-4 py-8 md:p-8"
          >
            <form id="addItemForm" class="space-y-4 md:space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <div class="space-y-2">
                  <label class="block text-sm font-medium"
                    >Vehicle number</label
                  >
                  <p
                    id="NewVehicle-id"
                    class="text-lg font-semibold text-blue-600 dark:text-blue-400"
                  ></p>
                </div>
                <div class="space-y-2">
                  <label for="category" class="block text-sm font-medium"
                    >Vehicle category</label
                  >
                  <select
                    name="category"
                    id="category"
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 appearance-none"
                  >
                    <option value="1">Category A</option>
                    <option value="2">Category B</option>
                    <option value="3">Category C</option>
                    <option value="4">Category D</option>
                  </select>
                </div>
                <div class="space-y-2">
                  <label for="input-part-no" class="block text-sm font-medium"
                    >Vehicle name</label
                  >
                  <input
                    type="text"
                    id="input-part-no"
                    placeholder="Enter Vehicle name"
                    required
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
                <div class="space-y-2">
                  <label for="file" class="block text-sm font-medium"
                    >Upload Vehicle image</label
                  >
                  <input
                    type="file"
                    id="file"
                    name="img"
                    accept="image/*"
                    class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                  />
                </div>
                <div class="space-y-2">
                  <label for="input-weight" class="block text-sm font-medium"
                    >Weight</label
                  >
                  <input
                    type="number"
                    id="input-weight"
                    placeholder="Enter weight"
                    required
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
                <div class="space-y-2">
                  <label
                    for="input-stock-quantity"
                    class="block text-sm font-medium"
                    >Stock item quantity</label
                  >
                  <input
                    type="number"
                    id="input-stock-quantity"
                    placeholder="Enter stock item quantity"
                    required
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
                <div class="space-y-2">
                  <label for="input-price" class="block text-sm font-medium"
                    >Price</label
                  >
                  <input
                    type="number"
                    id="input-price"
                    placeholder="Enter price"
                    required
                    class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                  />
                </div>
              </div>
              <div class="space-y-2">
                <label for="description" class="block text-sm font-medium"
                  >Vehicle description</label
                >
                <textarea
                  id="description"
                  name="description"
                  rows="4"
                  placeholder="Enter Vehicle description"
                  class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
                ></textarea>
              </div>
              <div
                class="flex flex-col md:flex-row md:justify-end space-y-4 md:space-y-0 md:space-x-4"
              >
                <button
                  type="submit"
                  class="w-full md:w-auto px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-offset-gray-800 transition-colors duration-200"
                >
                  Add
                </button>

                <button
                  type="button"
                  onclick="location.href='Item.html'"
                  class="w-full md:w-auto px-6 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 dark:focus:ring-offset-gray-800 transition-colors duration-200"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </section>
      </section>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        generateNewVehicleId();
        document
          .getElementById("addItemForm")
          .addEventListener("submit", handleSubmit);
      });

      function generateNewVehicleId() {
        fetch("../../resources/php/ManageItem.php?action=getNewVehicleId")
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              document.getElementById("NewVehicle-id").textContent = data.data;
            } else {
              throw new Error(
                data.message || "Failed to generate new Vehicle ID"
              );
            }
          })
          .catch((error) => {
            console.error("Error generating new Vehicle ID:", error);
            alert("Error generating new Vehicle ID: " + error.message);
          });
      }

      function handleSubmit(event) {
        event.preventDefault();
        addItem();
      }

      //make addItem() run one time only
      let isRunning = false;
      function addItem() {
        if (isRunning) {
          return;
        }
        isRunning = true;

        const VehicleNum = parseInt(
          document.getElementById("NewVehicle-id").textContent,
          10
        );
        if (isNaN(VehicleNum) || VehicleNum <= 0) {
          alert("Error: Invalid Vehicle number");
          isRunning = false;
          return;
        }

        var formData = {
          VehicleNum: VehicleNum,
          VehicleCategory: parseInt(
            document.getElementById("category").value,
            10
          ),
          VehicleName: document.getElementById("input-part-no").value,
          weight: parseFloat(document.getElementById("input-weight").value),
          stockItemQty: parseInt(
            document.getElementById("input-stock-quantity").value,
            10
          ),
          price: parseFloat(document.getElementById("input-price").value),
          VehicleDescription: document.getElementById("description").value,
        };

        const fileInput = document.getElementById("file");

        // Check if a file is selected
        if (fileInput.files.length > 0) {
          formData.image = fileInput.files[0].name;
        }

        console.log("Sending data:", formData);

        fetch("../../resources/php/ManageItem.php?action=add", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
          credentials: "include",
        })
          .then((response) => {
            console.log("Response status:", response.status);
            return response.text();
          })
          .then((text) => {
            console.log("Response text:", text);
            return JSON.parse(text);
          })
          .then((result) => {
            console.log("Parsed result:", result);
            if (result.status === "success") {
              console.log("Item added:", result);
              alert(
                "Vehicle added successfully! New Vehicle Number: " +
                  result.data.VehicleNum
              );
              window.location.href = "Item.html";
            } else {
              throw new Error(result.message || "Failed to add Vehicle");
            }
          })
          .catch((error) => {
            console.error("Error adding Vehicle:", error);
            alert("Error adding Vehicle: " + error.message);
          })
          .finally(() => {
            isRunning = false;
          });
      }
    </script>
  </body>
</html>
