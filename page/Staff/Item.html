<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spare Part Management</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/lib/index.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp,container-queries"></script>
    <script type="module" src="../../resources/js/tailwindcss.js"></script>
    <script type="module" src="../../resources/js/script.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link
      href="../../resources/image/SLMC_Icon_login.jpg"
      rel="icon"
      type="image/x-icon"
    />
    <script>
      function loadNumOfItem() {
        $.ajax({
          url: "../../resources/php/ManageItem.php?act=listTotal",
          type: "GET",
          dataType: "json",
          success: function (data) {
            document.getElementById("total-items").textContent =
              "Total: " + data.total + " Items";
          },
        });
      }
    </script>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white">
    <div class="flex h-screen">
      <!-- Navigation -->
      <nav
        class="bg-white border-gray-200 dark:bg-gray-900 w-64 flex-shrink-0 hidden md:flex md:flex-col"
      >
        <div class="flex flex-col items-center p-4">
          <a
            class="flex items-center space-x-3 rtl:space-x-reverse mb-6"
            href="#"
          >
            <div class="h-8 w-8 relative">
              <img
                alt="SLMC Logo"
                class="absolute inset-0 object-contain dark:hidden pt-2 dark:pt-1"
                src="../../resources/image/SLMC_LOGO.png"
              />
              <img
                alt="SLMC Logo"
                class="absolute inset-0 object-contain hidden dark:block"
                src="../../resources/image/SLMC_LOGO_DM.png"
              />
            </div>
            <span
              class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white"
              >SLMC</span
            >
          </a>

          <ul class="font-medium flex flex-col space-y-2">
            <li>
              <a
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
                href="order.html"
                >Order Record</a
              >
            </li>
            <li>
              <a
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
                href="Item.html"
                >Spare Part</a
              >
            </li>
            <li>
              <a
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
                href="genreport.html"
                >Generate Report</a
              >
            </li>
            <li>
              <a
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
                href="../../logout.html"
                onclick="logout()"
                >Log Out</a
              >
            </li>
          </ul>

          <!-- Dark mode toggle button -->
          <button
            class="mt-6 p-2 text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-700"
            id="darkModeToggle"
          >
            <svg
              class="w-5 h-5"
              fill="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
              ></path>
            </svg>
          </button>
        </div>
      </nav>

      <!-- Mobile Menu Button -->
      <div
        class="md:hidden flex items-center justify-between p-4 bg-white dark:bg-gray-900"
      >
        <a href="#" class="flex items-center space-x-3 rtl:space-x-reverse">
          <div class="h-8 w-8 relative">
            <img
              alt="SLMC Logo"
              class="absolute inset-0 object-contain dark:hidden pt-2 dark:pt-1"
              src="../../resources/image/SLMC_LOGO.png"
            />
            <img
              alt="SLMC Logo"
              class="absolute inset-0 object-contain hidden dark:block"
              src="../../resources/image/SLMC_LOGO_DM.png"
            />
          </div>
          <span
            class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white"
            >SLMC</span
          >
        </a>
        <button
          class="p-2 text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-700"
          id="mobileMenuButton"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            ></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Menu -->
      <div
        class="md:hidden flex flex-col"
        id="mobileMenu"
        style="display: none"
      >
        <ul
          class="font-medium flex flex-col space-y-2 p-4 bg-white dark:bg-gray-900"
        >
          <li>
            <a
              class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
              href="order.html"
              >Order Record</a
            >
          </li>
          <li>
            <a
              class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
              href="Item.html"
              >Spare Part</a
            >
          </li>
          <li>
            <a
              class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
              href="genreport.html"
              >Generate Report</a
            >
          </li>
          <li>
            <a
              class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
              href="../../logout.html"
              onclick="logout()"
              >Log Out</a
            >
          </li>
        </ul>
      </div>
      <body
        class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-body"
        onload="loadNumOfItem();"
      >
        <main class="container mx-auto px-4 py-4 sm:py-8">
          <section class="prose dark:prose-invert max-w-none">
            <h1 class="text-3xl font-bold mb-4">Current On Sale Items</h1>
            <h2 id="total-items" class="text-xl mb-4"></h2>

            <div class="flex flex-wrap gap-2 mb-4">
              <button
                onclick="itemAction('add')"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded"
              >
                Add New Item
              </button>
              <button
                onclick="itemAction('edit')"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded"
              >
                Edit Item
              </button>
              <button
                onclick="itemAction('delete');window.location.href = 'Item.html';"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded"
              >
                Delete Item
              </button>
            </div>
            <div
              id="loadingSpinner"
              class="hidden justify-center items-center my-4"
            >
              <div
                class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"
              ></div>
            </div>
            <div class="overflow-x-auto shadow-md sm:rounded-lg">
              <table
                id="sparePartsTable"
                class="w-full text-sm text-left text-gray-500 dark:text-gray-400"
              >
                <thead
                  class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"
                >
                  <tr>
                    <th scope="col" class="p-4">
                      <div class="flex items-center">
                        <input
                          id="checkbox-all"
                          type="checkbox"
                          class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
                        />
                        <label for="checkbox-all" class="sr-only"
                          >checkbox</label
                        >
                      </div>
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 cursor-pointer"
                      onclick="sortTable(1)"
                    >
                      Part number
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 cursor-pointer"
                      onclick="sortTable(2)"
                    >
                      Part category
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 cursor-pointer"
                      onclick="sortTable(3)"
                    >
                      Part name
                    </th>
                    <th scope="col" class="px-6 py-3">Part image</th>
                    <th scope="col" class="px-6 py-3">Part description</th>
                    <th
                      scope="col"
                      class="px-6 py-3 cursor-pointer"
                      onclick="sortTable(6)"
                    >
                      Weight (KG)
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 cursor-pointer"
                      onclick="sortTable(7)"
                    >
                      Stock item Qty
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 cursor-pointer"
                      onclick="sortTable(8)"
                    >
                      Part price
                    </th>
                  </tr>
                </thead>
                <tbody id="sparePartsTableBody">
                  <!-- Table rows will be inserted here by JavaScript -->
                </tbody>
              </table>
            </div>
          </section>
          <script>
            document.addEventListener("DOMContentLoaded", function () {
              getSparePartList();
              const darkModeToggle = document.getElementById("darkModeToggle");

              // Function to toggle dark mode
              function toggleDarkMode() {
                document.documentElement.classList.toggle("dark");
                localStorage.setItem(
                  "darkMode",
                  document.documentElement.classList.contains("dark")
                );
              }

              // Set initial dark mode based on user preference or system setting
              if (
                localStorage.getItem("darkMode") === "true" ||
                (window.matchMedia &&
                  window.matchMedia("(prefers-color-scheme: dark)").matches)
              ) {
                document.documentElement.classList.add("dark");
              } else {
                document.documentElement.classList.remove("dark");
              }

              // Add click event listener to the dark mode toggle button
              darkModeToggle.addEventListener("click", toggleDarkMode);
            });
            function showLoading() {
              document
                .getElementById("loadingSpinner")
                .classList.remove("hidden");
              // Hide the Table
              document
                .getElementById("sparePartsTable")
                .classList.add("hidden");
            }

            function hideLoading() {
              document.getElementById("loadingSpinner").classList.add("hidden");
              // Show the Table
              document
                .getElementById("sparePartsTable")
                .classList.remove("hidden");
            }

            // mock data
            const mockItems = [
              {
                id: "1",
                partNumber: "SL00001",
                partCategory: "Category A",
                partName: "Tinned Plate",
                partImage: "../../resources/image/spare/A/100001.jpg",
                description: "The front for Toyota",
                weight: 20,
                stockQuantity: 37,
                price: "597 HKD",
              },
            ];

            function getSparePartList() {
              showLoading();
              // Fetch spare parts data from the server
              fetch("/api/spare-parts")
                .then((response) => response.json())
                .then((data) => {
                  renderSparePartsTable(data);
                  updateTotalItems(data.length);
                  // mock data
                  renderSparePartsTable(mockItems);
                  updateTotalItems(mockItems.length);

                  if (data.length === 0) {
                    updateTotalItems(0);
                  }
                })
                .catch((error) =>
                  console.error("Error fetching spare parts:", error)
                )
                .finally(() => hideLoading());
            }
            function updateTotalItems() {
              const totalItems = document.getElementById("total-items");
              if (totalItems) {
                totalItems.textContent = `Total: ${spareParts.length} Items`;
              }
            }

            function itemAction(action) {
              switch (action) {
                case "add":
                  addItem();
                  break;
                case "edit":
                  editItem();
                  break;
                case "delete":
                  deleteItem();
                  loadNumOfItem();
                  break;
              }

              console.log(`${action} action triggered`);
            }

            function sortTable(columnIndex) {
              // Implement table sorting logic
              console.log(`Sorting by column ${columnIndex}`);
            }

            function addItem() {
              // redirect to addItem.html
              // find the max id from the table and add 1 to it
              const maxId = Math.max(
                ...spareParts.map((part) => parseInt(part.id))
              );
              window.location.href = `AddItem.html?id=${maxId + 1}`;

              console.log("Add item");
            }
            function editItem() {
              console.log("Edit item");
            }
            function deleteItem() {
              console.log("Delete item");
            }
          </script>
          <!-- <script>
    document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM fully loaded");
    loadAndRenderSpareParts();
});
</script> -->
          <script src="../../resources/js/ManageItem.js"></script>
          <script>
            document.addEventListener("DOMContentLoaded", initSpareParts);
          </script>
          <footer
            class="bg-white border-t border-gray-200 dark:bg-gray-900 dark:border-gray-700"
            id="footer"
          >
            <div class="container mx-auto px-4 py-8">
              <div
                class="flex flex-col md:flex-row justify-between items-center"
              >
                <div class="mb-4 md:mb-0">
                  <span class="text-sm text-gray-500 dark:text-gray-400"
                    >Copyright &copy; 2024 Legend Motor Limited</span
                  >
                </div>
                <nav
                  class="flex flex-wrap justify-center md:justify-end space-x-4 md:space-x-6"
                >
                  <a
                    href="#"
                    class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
                    >About Us</a
                  >
                  <a
                    href="#"
                    class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
                    >Contact Us</a
                  >
                  <a
                    href="#"
                    class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
                    >Order Tracking</a
                  >
                  <a
                    href="#"
                    class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
                    >Returns</a
                  >
                  <a
                    href="#"
                    class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
                    >FAQ</a
                  >
                </nav>
              </div>
              <div
                class="mt-4 flex flex-wrap justify-center md:justify-end space-x-4 md:space-x-6"
              >
                <a
                  href="#"
                  class="text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"
                  >Terms of Service</a
                >
                <a
                  href="#"
                  class="text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"
                  >Privacy Policy</a
                >
                <a
                  href="#"
                  class="text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"
                  >Site Map</a
                >
              </div>
            </div>
          </footer>
        </main>
      </body>
    </div>
  </body>
</html>
